# Build Documentation

## Overview

This project now uses **Vite** as a modern build tool with PWA (Progressive Web App) support for optimal performance.

## Project Structure

```
ScripCalculator/
â”œâ”€â”€ src/               # Source files
â”‚   â”œâ”€â”€ index.html     # Main HTML file
â”‚   â”œâ”€â”€ css/           # Stylesheets
â”‚   â”œâ”€â”€ js/            # JavaScript files
â”‚   â”œâ”€â”€ data/          # Legacy data location (not used in build)
â”‚   â””â”€â”€ public/        # Static assets (copied to dist root)
â”‚       â””â”€â”€ menu.json  # Menu data
â”œâ”€â”€ dist/              # Built files (generated, not in git)
â”œâ”€â”€ css/               # Original CSS (kept for reference)
â”œâ”€â”€ js/                # Original JS (kept for reference)
â”œâ”€â”€ data/              # Original data (kept for reference)
â”œâ”€â”€ index.html         # Deployed version (generated by deploy.sh)
â””â”€â”€ assets/            # Deployed assets (generated by deploy.sh)
```

## Development

### Prerequisites

- Node.js 16+ and npm

### Setup

```bash
# Install dependencies
npm install

# Start development server
npm run dev
```

The dev server will start at `http://localhost:5173` with hot module replacement.

## Building for Production

### Quick Build

```bash
npm run build
```

This creates optimized files in the `dist/` directory.

### Deploy to GitHub Pages

```bash
./deploy.sh
```

This script:
1. Builds the production bundle
2. Copies built files to the root directory
3. Updates the data/menu.json file

After running, commit and push to deploy to GitHub Pages.

## Build Output

### Size Comparison

**Before (vanilla):**
- Total: ~20KB
- No minification
- No PWA support
- No offline capability

**After (with Vite + PWA):**
- Core bundle: ~19KB (HTML + CSS + JS + JSON)
- Service worker: ~24KB (workbox + sw.js)
- **Total: ~51KB** including full PWA support
- All files minified and optimized
- Offline support included
- Installable as app

### Build Features

âœ… **Minification**: JavaScript and CSS are minified with Terser
âœ… **PWA Support**: Service worker for offline functionality
âœ… **Code Splitting**: Automatic chunk optimization
âœ… **Font Caching**: Google Fonts cached for offline use
âœ… **Asset Optimization**: All assets optimized for production
âœ… **Module Bundling**: ES modules properly bundled
âœ… **Cache Busting**: Hashed filenames for cache control

## PWA Features

The app now includes:

- **Offline Support**: Works without internet after first load
- **Installable**: Can be installed as a standalone app on mobile/desktop
- **Fast Loading**: Service worker provides instant loading on repeat visits
- **Cached Fonts**: Google Fonts work offline
- **Auto-Update**: Service worker automatically updates when new version is deployed

## File Sizes (gzipped)

- `index.html`: 1.32 KB
- `index-*.css`: 1.62 KB
- `index-*.js`: 2.02 KB
- `menu.json`: ~1.5 KB (uncompressed)
- `sw.js`: ~0.8 KB
- `workbox-*.js`: ~10 KB

**Total first load: ~17KB gzipped** (excluding cached fonts)

## Configuration

### Vite Config (`vite.config.js`)

Key settings:
- Root: `src/` directory
- Output: `dist/` directory
- Minification: Terser with optimizations
- PWA plugin with service worker

### PWA Manifest

Located at `dist/manifest.webmanifest`:
- App name: "Scrip Calculator - Punahou Carnival 2025"
- Theme color: #4A2511 (brown)
- Display: Standalone
- Icons: Emoji-based (ðŸ¤ )

## Deployment Notes

### GitHub Pages

The root `index.html` and `assets/` are the deployed files. GitHub Pages serves these directly.

### Cache Strategy

- **Google Fonts**: Cache-first (1 year)
- **App files**: Service worker precache with auto-update
- **Menu data**: Included in precache

## Troubleshooting

### Build fails

```bash
# Clean and reinstall
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Changes not showing

```bash
# Clear service worker
# In browser DevTools: Application > Service Workers > Unregister
# Then hard refresh (Ctrl+Shift+R)
```

### Menu data not loading

Ensure `src/public/menu.json` exists and is valid JSON.

## Performance Metrics (Estimated)

With this build:

- **First Contentful Paint (FCP)**: <1s
- **Time to Interactive (TTI)**: <1.5s
- **Lighthouse Score**: 95-100/100
- **Total Blocking Time**: <100ms
- **Bundle Size**: 17KB gzipped

## Future Improvements

Potential optimizations:
- [ ] Self-host fonts for better control
- [ ] Add image optimization pipeline
- [ ] Implement code splitting for larger apps
- [ ] Add TypeScript for type safety
- [ ] Add automated testing
